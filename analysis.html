<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠ¤ë§ˆíŠ¸ ì•ˆì „ ì§€í‚´ì´ (Netlify Ver.)</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root { --primary-color: #0056b3; --bg-color: #ebedf0; }
        body { font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); margin: 0; padding: 0; color: #333; }

        /* === ì›¹ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ === */
        .app-container { max-width: 500px; margin: 0 auto; background: white; min-height: 100vh; display: flex; flex-direction: column; }
        header { background: white; padding: 20px; text-align: center; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 100; }
        .content-area { padding: 20px; flex: 1; background: #f8f9fa; }
        
        .card { background: white; border-radius: 16px; padding: 20px; margin-bottom: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.04); overflow: hidden; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        input { width: 100%; padding: 14px; border: 1px solid #e9ecef; border-radius: 10px; box-sizing: border-box; }
        
        .btn { width: 100%; padding: 16px; border: none; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; justify-content: center; gap: 8px; margin-top: 15px;}
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-outline { background: white; border: 1px solid #ddd; color: #555; }
        
        /* ì‚¬ì§„ ìŠ¤íƒ€ì¼ */
        .photo-container { display: flex; gap: 10px; margin-top: 15px; margin-bottom: 15px; }
        .photo-wrapper { flex: 1; display: flex; flex-direction: column; }
        .report-img { width: 100%; aspect-ratio: 4/3; object-fit: cover; border-radius: 8px; background: #eee; border: 1px solid #eee; margin-top: 5px; }

        .accordion-header { background: #f8f9fa; padding: 12px; border-radius: 8px; cursor: pointer; display: flex; justify-content: space-between; margin-top: 10px; font-weight: 600; font-size: 14px; }
        .accordion-content { padding: 15px; background: #fff; border: 1px solid #f8f9fa; font-size: 14px; white-space: pre-wrap; line-height: 1.6; }
        .hidden { display: none !important; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .tab-container { padding: 15px 20px 0; background: white; }
        .tab-switch { display: flex; background: #f1f3f5; border-radius: 12px; padding: 4px; position: relative; }
        .tab-indicator { position: absolute; top: 4px; bottom: 4px; left: 4px; width: calc(50% - 4px); background: white; border-radius: 10px; transition: transform 0.3s; z-index: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.08); }
        .tab-btn { flex: 1; border: none; background: transparent; padding: 12px; font-weight: 600; color: #868e96; cursor: pointer; z-index: 2; }
        .tab-btn.active { color: #333; }

        /* ë’¤ë¡œê°€ê¸° ë§í¬ (analysis.html ìŠ¤íƒ€ì¼ ìœ ì§€) */
        .back-link { display: inline-block; margin-bottom: 10px; text-decoration: none; color: #666; font-size: 0.9rem; padding: 10px; }

        /* PDF ìˆ¨ê¹€ ì˜ì—­ */
        #pdf-hidden-area { position: absolute; top: 0; left: -9999px; }
        .pdf-page { width: 210mm; min-height: 297mm; background: white; padding: 20mm; box-sizing: border-box; font-family: 'Pretendard', sans-serif; color: #000; display: flex; flex-direction: column; }
        .pdf-header { text-align: center; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; }
        .pdf-title { font-size: 24px; font-weight: bold; }
        .pdf-sub { font-size: 12px; color: #555; margin-top: 5px; }
        .pdf-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .pdf-table th, .pdf-table td { border: 1px solid #333; padding: 12px; text-align: left; font-size: 14px; }
        .pdf-table th { background: #f0f0f0; text-align: center; width: 100px; font-weight: bold; }
        .pdf-section-title { font-size: 16px; font-weight: bold; margin: 20px 0 10px; border-left: 5px solid #0056b3; padding-left: 10px; }
        .pdf-photos { display: flex; gap: 15px; margin-top: 10px; }
        .pdf-photo-box { flex: 1; text-align: center; border: 1px solid #ddd; padding: 10px; border-radius: 5px; }
        .pdf-photo-img { width: 100%; height: 250px; object-fit: cover; margin-bottom: 5px; }
        .pdf-text-box { border: 1px solid #333; padding: 20px; min-height: 500px; font-size: 14px; line-height: 1.8; white-space: pre-wrap; }
        .sign-area { margin-top: auto; text-align: right; font-size: 16px; padding-top: 30px; }
    </style>
</head>
<body>

<div class="app-container">
    <a href="index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
    <header><h1><i class="fa-solid fa-helmet-safety" style="color:#f59f00;"></i> ìŠ¤ë§ˆíŠ¸ ì•ˆì „ ì§€í‚´ì´</h1></header>

    <div class="tab-container">
        <div class="tab-switch">
            <div class="tab-indicator" id="tabIndicator"></div>
            <button class="tab-btn active" onclick="switchTab(0)">ğŸš¨ ìœ„í—˜ ì‹ ê³ </button>
            <button class="tab-btn" onclick="switchTab(1)">âœ… ì¡°ì¹˜ ì¸ì¦</button>
        </div>
    </div>

    <div class="content-area">
        <div id="reportSection">
            <div class="card">
                <h3>ğŸ“ ì‘ì—…ì ì •ë³´</h3>
                <div class="input-group">
                    <div style="flex:2;"><input type="text" id="nickName" placeholder="ë³„ëª… (ì˜ˆ: ê¹€ë°˜ì¥)"></div>
                    <div style="flex:1;"><input type="text" id="phoneEnd" placeholder="1234" maxlength="4" style="text-align:center;"></div>
                </div>
                <label>ğŸ“¸ í˜„ì¥ ì‚¬ì§„</label>
                <input type="file" id="beforeFile" accept="image/*">
                <button class="btn btn-primary" id="reportBtn" onclick="processReport()">AI ë¶„ì„ ë° ì ‘ìˆ˜</button>
            </div>
            <div id="aiResult" class="card hidden">
                <h4>ğŸ¤– AI ë¶„ì„ ê²°ê³¼</h4>
                <div id="diagnosisText" style="font-size:14px; line-height:1.6; white-space: pre-wrap;"></div>
            </div>
        </div>

        <div id="actionSection" class="hidden">
            <div class="card">
                <h3>ğŸ” ë‚´ì—­ ì¡°íšŒ</h3>
                <div class="input-group">
                    <input type="text" id="searchNick" placeholder="ë³„ëª…">
                    <input type="text" id="searchPhone" placeholder="1234">
                </div>
                <button class="btn btn-outline" onclick="searchMyList()">ì¡°íšŒí•˜ê¸°</button>
            </div>
            <div id="pendingList"></div>
        </div>
    </div>
</div>

<div id="pdf-hidden-area">
    <div id="pdf-page-1" class="pdf-page">
        <div class="pdf-header">
            <div class="pdf-title">ê±´ì„¤ í˜„ì¥ ìœ„í—˜ì„± í‰ê°€ ê²°ê³¼ì„œ</div>
            <div class="pdf-sub">Smart Construction Safety Report</div>
        </div>
        <table class="pdf-table">
            <tr>
                <th>ë¬¸ì„œ ë²ˆí˜¸</th><td id="pdf-id"></td><th>ì‘ì„± ì¼ì</th><td id="pdf-date"></td>
            </tr>
            <tr>
                <th>í˜„ì¥ ëª…ì¹­</th><td>ì „êµ­ í‘œì¤€ í˜„ì¥</td><th>ì‘ ì—… ì</th><td id="pdf-worker"></td>
            </tr>
            <tr>
                <th>í‰ê°€ ê²°ê³¼</th><td colspan="3" id="pdf-score" style="font-weight:bold; color:blue;"></td>
            </tr>
        </table>
        <div class="pdf-section-title">1. í˜„ì¥ ì¡°ì¹˜ ì‚¬ì§„ (Before & After)</div>
        <div class="pdf-photos">
            <div class="pdf-photo-box">
                <div style="font-weight:bold; margin-bottom:5px; background:#eee; padding:5px;">[ ì¡°ì¹˜ ì „ - Before ]</div>
                <img id="pdf-img-before" class="pdf-photo-img" crossOrigin="anonymous">
            </div>
            <div class="pdf-photo-box">
                <div style="font-weight:bold; margin-bottom:5px; background:#d4edda; padding:5px;">[ ì¡°ì¹˜ í›„ - After ]</div>
                <img id="pdf-img-after" class="pdf-photo-img" crossOrigin="anonymous">
            </div>
        </div>
        <div style="margin-top:auto; font-size:12px; color:#999; text-align:center;">- 1 / 2 page -</div>
    </div>
    <div id="pdf-page-2" class="pdf-page">
        <div class="pdf-header"><div class="pdf-title">ìƒì„¸ ì¡°ì¹˜ ê²°ê³¼</div></div>
        <div class="pdf-section-title">2. AI ìœ„í—˜ì„± ë¶„ì„ ë° ì¡°ì¹˜ ë‚´ì—­</div>
        <div id="pdf-ai-text" class="pdf-text-box"></div>
        <div class="sign-area">
            <p>ìœ„ì™€ ê°™ì´ ì•ˆì „ ì¡°ì¹˜ë¥¼ ì™„ë£Œí•˜ì˜€ìŒì„ ë³´ê³ í•©ë‹ˆë‹¤.</p><br><br><br>
            <p>ì‘ì„±ì : <span id="pdf-sign-name" style="font-weight:bold;"></span> (ì„œëª…)</p><br>
            <p>í™•ì¸ì : ì•ˆì „ê´€ë¦¬ì±…ì„ì (ì„œëª…)</p>
        </div>
        <div style="margin-top:auto; font-size:12px; color:#999; text-align:center;">- 2 / 2 page -</div>
    </div>
</div>

<script type="module">
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
    // Netlify í™˜ê²½ë³€ìˆ˜ì—ì„œ ìƒì„±ëœ apikey.js ë¶ˆëŸ¬ì˜¤ê¸° (ë³´ì•ˆ)
    import { CONFIG } from './apikey.js';

    // === Supabase ì„¤ì • (ê¸°ì¡´ í‚¤ ìœ ì§€) ===
    // âš ï¸ ì£¼ì˜: ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œ Supabase í‚¤ë„ Netlify í™˜ê²½ë³€ìˆ˜ë¡œ ì˜®ê¸°ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.
    const SUPABASE_URL = 'https://yrerfkfyilucucgwoyyq.supabase.co'; 
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlyZXJma2Z5aWx1Y3VjZ3dveXlxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzNjgzNzMsImV4cCI6MjA3ODk0NDM3M30.2b2Y4Uano6qL6veJhtXY3lxhvMwY01fvraXe9vaDALk';

    // í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // === Gemini ì„¤ì • (Netlify í™˜ê²½ë³€ìˆ˜ ì‚¬ìš©) ===
    // apikey.jsì—ì„œ ë¶ˆëŸ¬ì˜¨ CONFIG.GEMINI_KEYë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    const genAI = new GoogleGenerativeAI(CONFIG.GEMINI_KEY);
    // ì•ˆì •ì ì¸ 1.5 Flash ëª¨ë¸ ì‚¬ìš©
    const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" }); 

    // === í•¨ìˆ˜ ì •ì˜ ë° window ê°ì²´ í• ë‹¹ (HTML onclick í˜¸í™˜ìš©) ===

    // 1. íƒ­ ì „í™˜
    window.switchTab = (index) => {
        const indicator = document.getElementById('tabIndicator');
        const btns = document.querySelectorAll('.tab-btn');
        const sections = [document.getElementById('reportSection'), document.getElementById('actionSection')];
        indicator.style.transform = `translateX(${index * 100}%)`;
        btns.forEach((btn, i) => btn.classList.toggle('active', i === index));
        sections.forEach((sec, i) => { i === index ? sec.classList.remove('hidden') : sec.classList.add('hidden'); });
    }

    // 2. ì•„ì½”ë””ì–¸ í† ê¸€
    window.toggleAccordion = (id) => {
        const content = document.getElementById(`diagnosis-${id}`);
        const icon = document.getElementById(`icon-${id}`);
        content.classList.toggle('hidden');
        icon.className = content.classList.contains('hidden') ? 'fa-solid fa-chevron-down' : 'fa-solid fa-chevron-up';
    };

    // 3. íŒŒì¼ -> GenerativePart ë³€í™˜
    async function fileToGenerativePart(file) {
        return new Promise((r) => {
            const reader = new FileReader();
            reader.onloadend = () => r({ inlineData: { data: reader.result.split(",")[1], mimeType: file.type } });
            reader.readAsDataURL(file);
        });
    }

    // 4. ë¦¬í¬íŠ¸ ì œì¶œ (AI ë¶„ì„)
    window.processReport = async () => {
        const nick = document.getElementById('nickName').value.trim();
        const phone = document.getElementById('phoneEnd').value.trim();
        const fileInput = document.getElementById('beforeFile');
        const btn = document.getElementById('reportBtn');

        if (!nick || phone.length < 4 || !fileInput.files[0]) return alert("ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        
        btn.disabled = true;
        btn.innerText = "ğŸš¨ ë¶„ì„ ì¤‘...";

        try {
            const file = fileInput.files[0];
            const imagePart = await fileToGenerativePart(file);
            const prompt = `ë‹¹ì‹ ì€ ê±´ì„¤ ì•ˆì „ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. 
            1. 'ğŸš¨ [ê¸´ê¸‰] ìµœìš°ì„  ì¡°ì¹˜ ì‚¬í•­ (TOP 2)'ë¥¼ ì„ ì •í•˜ì„¸ìš”.
            2. ë‚˜ë¨¸ì§€ëŠ” 'ê¸°íƒ€'ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”.
            ë‹µë³€ì€ í•œêµ­ì–´ë¡œ ëª…í™•í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”.`;

            const result = await model.generateContent([prompt, imagePart]);
            const response = await result.response;
            const aiText = response.text();
            
            document.getElementById('diagnosisText').innerText = aiText;
            document.getElementById('aiResult').classList.remove('hidden');
            
            // Supabase ìŠ¤í† ë¦¬ì§€ ì—…ë¡œë“œ
            const fileName = `before_${Date.now()}.jpg`;
            await supabase.storage.from('site_photos').upload(fileName, file);
            const { data: { publicUrl } } = supabase.storage.from('site_photos').getPublicUrl(fileName);

            // DB ì €ì¥
            const { error } = await supabase.from('safety_reports').insert([{
                worker_name: `${nick}_${phone}`,
                before_image_url: publicUrl,
                ai_diagnosis: aiText,
                status: 'pending'
            }]);

            if (error) throw error;
            alert("ì ‘ìˆ˜ ì™„ë£Œ!");
            document.getElementById('searchNick').value = nick;
            document.getElementById('searchPhone').value = phone;

        } catch (e) { 
            console.error(e);
            alert("ì˜¤ë¥˜: " + e.message); 
        } 
        finally { btn.disabled = false; btn.innerText = "AI ë¶„ì„ ë° ì ‘ìˆ˜"; }
    };

    // 5. ë‚´ì—­ ì¡°íšŒ
    window.searchMyList = async () => {
        const nick = document.getElementById('searchNick').value.trim();
        const phone = document.getElementById('searchPhone').value.trim();
        const listDiv = document.getElementById('pendingList');
        
        if (!nick || phone.length < 4) return alert("ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        listDiv.innerHTML = "<div style='text-align:center; padding:20px;'>ì¡°íšŒ ì¤‘...</div>";

        const { data, error } = await supabase.from('safety_reports').select('*').eq('worker_name', `${nick}_${phone}`).order('created_at', { ascending: false });

        if (error || !data.length) { listDiv.innerHTML = "<div style='text-align:center; padding:20px;'>ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>"; return; }

        listDiv.innerHTML = "";
        data.forEach(item => {
            const isResolved = item.status === 'resolved';
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <span class="badge ${isResolved ? 'badge-success' : 'badge-pending'}">${isResolved ? 'ì™„ë£Œ' : 'ëŒ€ê¸°'}</span>
                    <small>${new Date(item.created_at).toLocaleDateString()}</small>
                </div>
                <div class="accordion-header" onclick="toggleAccordion('${item.id}')">
                    <span>ì§€ì ì‚¬í•­ ë³´ê¸°</span><i id="icon-${item.id}" class="fa-solid fa-chevron-down"></i>
                </div>
                <div id="diagnosis-${item.id}" class="accordion-content hidden">${item.ai_diagnosis}</div>
                
                <div class="photo-container">
                    <div class="photo-wrapper">
                        <small>Before</small>
                        <img src="${item.before_image_url}" crossOrigin="anonymous" class="report-img">
                    </div>
                    ${item.after_image_url ? `
                    <div class="photo-wrapper">
                        <small>After</small>
                        <img src="${item.after_image_url}" crossOrigin="anonymous" class="report-img">
                    </div>` : ''}
                </div>

                ${!isResolved ? `
                    <div style="margin-top:10px;">
                        <input type="file" id="afterFile_${item.id}" accept="image/*">
                        <button class="btn btn-success" onclick="verifyAction(this, '${item.id}', '${item.ai_diagnosis.replace(/\n/g, ' ')}')">AI ê²€ì‚¬ ì‹œì‘</button>
                    </div>` : `
                    <button class="btn btn-primary" onclick="generateRealPDF('${item.id}', '${item.worker_name}', '${item.created_at}', '${encodeURIComponent(item.ai_diagnosis)}', '${item.before_image_url}', '${item.after_image_url}', '${item.safety_score}')">
                        ğŸ“„ ë³´ê³ ì„œ ì¶œë ¥ (A4 ì–‘ì‹)
                    </button>`
                }
            `;
            listDiv.appendChild(div);
        });
    };

    // 6. ì¡°ì¹˜ í™•ì¸ (AI ê²€ì¦)
    window.verifyAction = async (btn, id, diagnosis) => {
        const fileInput = document.getElementById(`afterFile_${id}`);
        if (!fileInput.files[0]) return alert("ì‚¬ì§„ í•„ìˆ˜");
        
        btn.disabled = true; btn.innerText = "ì±„ì  ì¤‘...";
        try {
            const file = fileInput.files[0];
            const imagePart = await fileToGenerativePart(file);
            const prompt = `ê³¼ê±° ì§€ì : "${diagnosis}"\n1. TOP 2 í•´ê²° ì—¬ë¶€ í™•ì¸.\n2. ì ìˆ˜(0~100).\nJSON ë‹µë³€: {"score": 80, "reason": "í•´ê²°ë¨"}`;
            
            const result = await model.generateContent([prompt, imagePart]);
            const response = await result.response;
            let text = response.text();
            
            // JSON íŒŒì‹± (ë§ˆí¬ë‹¤ìš´ ì œê±°)
            text = text.replace(/```json|```/g, "").trim();
            const aiData = JSON.parse(text);

            if (aiData.score >= 40) { // 40ì  ì´ìƒ í•©ê²©
                const fileName = `after_${Date.now()}.jpg`;
                await supabase.storage.from('site_photos').upload(fileName, file);
                const { data: { publicUrl } } = supabase.storage.from('site_photos').getPublicUrl(fileName);
                await supabase.from('safety_reports').update({ status: 'resolved', after_image_url: publicUrl, safety_score: aiData.score }).eq('id', id);
                alert("í•©ê²©! (" + aiData.score + "ì )"); 
                searchMyList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else { 
                alert("ë¶ˆí•©ê²©: " + aiData.reason); 
            }
        } catch (e) { 
            console.error(e);
            alert("ì˜¤ë¥˜: " + e.message); 
        } finally { btn.disabled = false; btn.innerText = "AI ê²€ì‚¬ ì‹œì‘"; }
    };

    // 7. PDF ìƒì„±
    window.generateRealPDF = async (id, worker, date, diagnosis, beforeUrl, afterUrl, score) => {
        // ì´ë²¤íŠ¸ íƒ€ê²Ÿ(ë²„íŠ¼) ì°¾ê¸°
        const btn = event.target || event.currentTarget;
        const originalText = btn.innerText;
        btn.disabled = true; btn.innerText = "PDF ìƒì„± ì¤‘...";

        // 1. ë°ì´í„° ì±„ìš°ê¸° (Page 1)
        document.getElementById('pdf-id').innerText = id.substring(0, 8);
        document.getElementById('pdf-date').innerText = new Date(date).toLocaleDateString();
        document.getElementById('pdf-worker').innerText = worker;
        document.getElementById('pdf-score').innerText = score + "ì  (í•©ê²©)";
        document.getElementById('pdf-img-before').src = beforeUrl;
        document.getElementById('pdf-img-after').src = afterUrl;

        // 2. ë°ì´í„° ì±„ìš°ê¸° (Page 2)
        document.getElementById('pdf-ai-text').innerText = decodeURIComponent(diagnosis);
        document.getElementById('pdf-sign-name').innerText = worker.split('_')[0];

        // ì´ë¯¸ì§€ ë¡œë”© ëŒ€ê¸°
        await new Promise(r => setTimeout(r, 1000));

        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = 210;
        const pageHeight = 297;

        // Page 1 ìº¡ì²˜ ë° ì¶”ê°€
        const page1 = document.getElementById('pdf-page-1');
        const canvas1 = await html2canvas(page1, { scale: 2, useCORS: true });
        const imgData1 = canvas1.toDataURL('image/png');
        pdf.addImage(imgData1, 'PNG', 0, 0, pageWidth, pageHeight);

        // Page 2 ì¶”ê°€
        pdf.addPage();
        const page2 = document.getElementById('pdf-page-2');
        const canvas2 = await html2canvas(page2, { scale: 2, useCORS: true });
        const imgData2 = canvas2.toDataURL('image/png');
        pdf.addImage(imgData2, 'PNG', 0, 0, pageWidth, pageHeight);

        pdf.save(`ì•ˆì „ë³´ê³ ì„œ_${worker}.pdf`);
        btn.disabled = false; btn.innerText = originalText;
    };
</script>
</body>
</html>