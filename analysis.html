<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì°¨ì‚¬ê³  ë¶„ì„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
        <h2>ğŸ“¸ ì•„ì°¨ì‚¬ê³  ìœ„í—˜ ë¶„ì„</h2>

        <input type="file" id="image-input" accept="image/*" style="display:none;" onchange="previewImage(event)">
        <button class="btn" onclick="document.getElementById('image-input').click()">ğŸ“· ì‚¬ì§„ ì´¬ì˜ / ì—…ë¡œë“œ</button>
        
        <img id="preview" alt="ë¯¸ë¦¬ë³´ê¸°">
        <button class="btn" id="analyze-btn" onclick="analyze()" style="display:none; background-color: #27ae60;">ğŸ” AI ë¶„ì„ ì‹œì‘</button>

        <div id="result-area" style="display:none;"></div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        import { CONFIG } from './apikey.js';

        window.previewImage = function(event) {
            const file = event.target.files[0];
            if (file) {
                const img = document.getElementById('preview');
                img.src = URL.createObjectURL(file);
                img.style.display = 'block';
                document.getElementById('analyze-btn').style.display = 'block';
                document.getElementById('result-area').style.display = 'none';
            }
        }

        window.analyze = async function() {
            const fileInput = document.getElementById('image-input');
            const resultDiv = document.getElementById('result-area');
            
            resultDiv.style.display = 'block';
            resultDiv.innerText = "â³ Geminiê°€ ìœ„í—˜ ìš”ì†Œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...";

            try {
                const genAI = new GoogleGenerativeAI(CONFIG.GEMINI_KEY);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });
                
                const file = fileInput.files[0];
                const base64Data = await new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(file);
                });

                const prompt = "ì´ ê±´ì„¤ í˜„ì¥ ì‚¬ì§„ì„ ë³´ê³  [ìœ„í—˜ ìš”ì†Œ / ì˜ˆìƒ ì‚¬ê³  / ì¡°ì¹˜ ì‚¬í•­ / ìœ„í—˜ ë“±ê¸‰] í˜•ì‹ìœ¼ë¡œ ê°„ë‹¨ëª…ë£Œí•˜ê²Œ ë³´ê³ ì„œë¥¼ ì¨ì¤˜.";
                
                const result = await model.generateContent([
                    prompt, 
                    { inlineData: { data: base64Data, mimeType: file.type } }
                ]);
                
                resultDiv.innerText = result.response.text();

            } catch (error) {
                resultDiv.innerText = "âŒ ì˜¤ë¥˜ ë°œìƒ: " + error.message;
            }
        }
    </script>
</body>
</html>