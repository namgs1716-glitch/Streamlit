<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSI ì±—ë´‡</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
        <h2>ğŸ¤– CSI ì•ˆì „ ê°€ì´ë“œ</h2>

        <div id="chat-box">
            <div class="message bot">ì•ˆë…•í•˜ì„¸ìš”! ê±´ì„¤ê³µì‚¬ ì•ˆì „ê´€ë¦¬ ì¢…í•©ì •ë³´ë§(CSI) ë° ì•ˆì „ ìˆ˜ì¹™ì— ëŒ€í•´ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”.</div>
        </div>

        <div class="input-area">
            <input type="text" id="user-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš” (ì—”í„°ë¡œ ì „ì†¡)" onkeypress="if(event.keyCode==13) sendMsg()">
            <button class="btn" onclick="sendMsg()">ì „ì†¡</button>
        </div>
    </div>

    <script type="module">
        import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
        import { CONFIG } from './apikey.js';

        const genAI = new GoogleGenerativeAI(CONFIG.GEMINI_KEY);
        const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

        window.sendMsg = async function() {
            const input = document.getElementById('user-input');
            const chatBox = document.getElementById('chat-box');
            const msg = input.value;
            if (!msg) return;

            // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
            chatBox.innerHTML += `<div class="message user">${msg}</div>`;
            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                // ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (ì±—ë´‡ì˜ í˜ë¥´ì†Œë‚˜ ì„¤ì •)
                const prompt = `
                    ë„ˆëŠ” í•œêµ­ì˜ 'ê±´ì„¤ê³µì‚¬ ì•ˆì „ê´€ë¦¬ ì¢…í•©ì •ë³´ë§(CSI)' ì „ë¬¸ AI ì±—ë´‡ì´ì•¼.
                    ê±´ì„¤ í˜„ì¥ ì‘ì—…ìë‚˜ ê´€ë¦¬ìê°€ ì•ˆì „ ê´€ë ¨ ì§ˆë¬¸ì„ í•˜ë©´, ì‚°ì—…ì•ˆì „ë³´ê±´ë²•ê³¼ CSI ë§¤ë‰´ì–¼ì— ê¸°ë°˜í•´ì„œ ì¹œì ˆí•˜ê³  ì „ë¬¸ì ìœ¼ë¡œ ë‹µë³€í•´ì¤˜.
                    ì§ˆë¬¸: ${msg}
                `;

                const result = await model.generateContent(prompt);
                const response = await result.response;
                const text = response.text();

                chatBox.innerHTML += `<div class="message bot">${text}</div>`;
            } catch (error) {
                chatBox.innerHTML += `<div class="message bot">âš ï¸ ì˜¤ë¥˜: ${error.message}</div>`;
            }
            chatBox.scrollTop = chatBox.scrollHeight;
        }
    </script>
</body>
</html>